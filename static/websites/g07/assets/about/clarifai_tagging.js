document.write( '<div class=\"highlight\" style=\"background: #f8f8f8\"><pre style=\"line-height: 125%;\"><span></span><span style=\"color: #008000; font-weight: bold\">from</span> <span style=\"color: #0000FF; font-weight: bold\">clarifai_grpc.grpc.api</span> <span style=\"color: #008000; font-weight: bold\">import</span> service_pb2, resources_pb2\n' );
document.write( '<span style=\"color: #008000; font-weight: bold\">from</span> <span style=\"color: #0000FF; font-weight: bold\">clarifai_grpc.grpc.api.status</span> <span style=\"color: #008000; font-weight: bold\">import</span> status_code_pb2\n' );
document.write( '<span style=\"color: #008000; font-weight: bold\">from</span> <span style=\"color: #0000FF; font-weight: bold\">clarifai_grpc.grpc.api</span> <span style=\"color: #008000; font-weight: bold\">import</span> service_pb2_grpc\n' );
document.write( '<span style=\"color: #008000; font-weight: bold\">from</span> <span style=\"color: #0000FF; font-weight: bold\">clarifai_grpc.channel.clarifai_channel</span> <span style=\"color: #008000; font-weight: bold\">import</span> ClarifaiChannel\n' );
document.write( '<span style=\"color: #008000; font-weight: bold\">from</span> <span style=\"color: #0000FF; font-weight: bold\">csv</span> <span style=\"color: #008000; font-weight: bold\">import</span> writer\n' );
document.write( '<span style=\"color: #008000; font-weight: bold\">from</span> <span style=\"color: #0000FF; font-weight: bold\">csv</span> <span style=\"color: #008000; font-weight: bold\">import</span> reader\n' );
document.write( '\n' );
document.write( '\n' );
document.write( '<span style=\"color: #3D7B7B; font-style: italic\"># csv file with elements to tag</span>\n' );
document.write( 'source <span style=\"color: #666666\">=</span> <span style=\"color: #BA2121\">\'csv/covid_unclassified_dataset.csv\'</span>\n' );
document.write( '\n' );
document.write( '<span style=\"color: #3D7B7B; font-style: italic\"># csv file where to store the tagged element</span>\n' );
document.write( 'target <span style=\"color: #666666\">=</span> <span style=\"color: #BA2121\">\'csv/covid_classified_dataset.csv\'</span>\n' );
document.write( '\n' );
document.write( '<span style=\"color: #3D7B7B; font-style: italic\"># the structure of the csv must be this</span>\n' );
document.write( '\n' );
document.write( '<span style=\"color: #3D7B7B; font-style: italic\"># | id  | img_link |</span>\n' );
document.write( '<span style=\"color: #3D7B7B; font-style: italic\">#  ----- ----------</span>\n' );
document.write( '<span style=\"color: #3D7B7B; font-style: italic\"># |  x  |    x     |</span>\n' );
document.write( '<span style=\"color: #3D7B7B; font-style: italic\">#  ----- ----------</span>\n' );
document.write( '<span style=\"color: #3D7B7B; font-style: italic\"># |  x  |    x     |</span>\n' );
document.write( '<span style=\"color: #3D7B7B; font-style: italic\">#  ----- ----------</span>\n' );
document.write( '<span style=\"color: #3D7B7B; font-style: italic\"># |  x  |    x     |</span>\n' );
document.write( '<span style=\"color: #3D7B7B; font-style: italic\">#  ----- ----------</span>\n' );
document.write( '\n' );
document.write( '<span style=\"color: #3D7B7B; font-style: italic\"># objects that send the request to Clarifai</span>\n' );
document.write( 'stub <span style=\"color: #666666\">=</span> service_pb2_grpc<span style=\"color: #666666\">.</span>V2Stub(ClarifaiChannel<span style=\"color: #666666\">.</span>get_grpc_channel())\n' );
document.write( '\n' );
document.write( '<span style=\"color: #3D7B7B; font-style: italic\"># authentication</span>\n' );
document.write( 'metadata <span style=\"color: #666666\">=</span> ((<span style=\"color: #BA2121\">\'authorization\'</span>, <span style=\"color: #BA2121\">f\'Key </span><span style=\"color: #A45A77; font-weight: bold\">{</span><span style=\"color: #BA2121\">\"PUT_YOUR_APPLICATION_KEY_HERE\"</span><span style=\"color: #A45A77; font-weight: bold\">}</span><span style=\"color: #BA2121\">\'</span>),)\n' );
document.write( '\n' );
document.write( '<span style=\"color: #3D7B7B; font-style: italic\"># open the file where to store the tagging</span>\n' );
document.write( 'classified <span style=\"color: #666666\">=</span> <span style=\"color: #008000\">open</span>(target, <span style=\"color: #BA2121\">\'a\'</span>, encoding<span style=\"color: #666666\">=</span><span style=\"color: #BA2121\">\'UTF8\'</span>, newline<span style=\"color: #666666\">=</span><span style=\"color: #BA2121\">\'\'</span>)\n' );
document.write( 'csv_writer <span style=\"color: #666666\">=</span> writer(classified)\n' );
document.write( '<span style=\"color: #3D7B7B; font-style: italic\"># write the header in the csv file</span>\n' );
document.write( 'csv_writer<span style=\"color: #666666\">.</span>writerow([<span style=\"color: #BA2121\">\'id\'</span>, <span style=\"color: #BA2121\">\'img_link\'</span>, <span style=\"color: #BA2121\">\'tag\'</span>, <span style=\"color: #BA2121\">\'value\'</span>])\n' );
document.write( '\n' );
document.write( '<span style=\"color: #3D7B7B; font-style: italic\"># open the file to read</span>\n' );
document.write( '<span style=\"color: #008000; font-weight: bold\">with</span> <span style=\"color: #008000\">open</span>(source, <span style=\"color: #BA2121\">\'r\'</span>, encoding<span style=\"color: #666666\">=</span><span style=\"color: #BA2121\">\"utf8\"</span>) <span style=\"color: #008000; font-weight: bold\">as</span> read_obj:\n' );
document.write( '    csv_reader <span style=\"color: #666666\">=</span> reader(read_obj)\n' );
document.write( '\n' );
document.write( '    <span style=\"color: #3D7B7B; font-style: italic\"># skip header</span>\n' );
document.write( '    header <span style=\"color: #666666\">=</span> <span style=\"color: #008000\">next</span>(csv_reader)\n' );
document.write( '\n' );
document.write( '    <span style=\"color: #3D7B7B; font-style: italic\"># for each row get the image link and analyze the image</span>\n' );
document.write( '    <span style=\"color: #008000; font-weight: bold\">for</span> row <span style=\"color: #AA22FF; font-weight: bold\">in</span> csv_reader:\n' );
document.write( '\n' );
document.write( '        <span style=\"color: #3D7B7B; font-style: italic\"># get image link</span>\n' );
document.write( '        image_link <span style=\"color: #666666\">=</span> row[<span style=\"color: #666666\">1</span>]\n' );
document.write( '        request <span style=\"color: #666666\">=</span> service_pb2<span style=\"color: #666666\">.</span>PostModelOutputsRequest(\n' );
document.write( '            <span style=\"color: #3D7B7B; font-style: italic\"># Use your model id</span>\n' );
document.write( '            model_id<span style=\"color: #666666\">=</span><span style=\"color: #BA2121\">\'PUT_YOUR_MODEL_ID_HERE\'</span>,\n' );
document.write( '            inputs<span style=\"color: #666666\">=</span>[\n' );
document.write( '                resources_pb2<span style=\"color: #666666\">.</span>Input(data<span style=\"color: #666666\">=</span>resources_pb2<span style=\"color: #666666\">.</span>Data(image<span style=\"color: #666666\">=</span>resources_pb2<span style=\"color: #666666\">.</span>Image(url<span style=\"color: #666666\">=</span>image_link)))\n' );
document.write( '            ])\n' );
document.write( '\n' );
document.write( '        <span style=\"color: #3D7B7B; font-style: italic\"># request the analysis</span>\n' );
document.write( '        response <span style=\"color: #666666\">=</span> stub<span style=\"color: #666666\">.</span>PostModelOutputs(request, metadata<span style=\"color: #666666\">=</span>metadata)\n' );
document.write( '\n' );
document.write( '        <span style=\"color: #3D7B7B; font-style: italic\"># handle errors</span>\n' );
document.write( '        <span style=\"color: #008000; font-weight: bold\">if</span> response<span style=\"color: #666666\">.</span>status<span style=\"color: #666666\">.</span>code <span style=\"color: #666666\">!=</span> status_code_pb2<span style=\"color: #666666\">.</span>SUCCESS:\n' );
document.write( '            <span style=\"color: #008000\">print</span>(<span style=\"color: #BA2121\">\"There was an error with your request!\"</span>)\n' );
document.write( '            <span style=\"color: #008000\">print</span>(<span style=\"color: #BA2121\">\"</span><span style=\"color: #AA5D1F; font-weight: bold\">t</span><span style=\"color: #BA2121\">Code: </span><span style=\"color: #A45A77; font-weight: bold\">{}</span><span style=\"color: #BA2121\">\"</span><span style=\"color: #666666\">.</span>format(response<span style=\"color: #666666\">.</span>outputs[<span style=\"color: #666666\">0</span>]<span style=\"color: #666666\">.</span>status<span style=\"color: #666666\">.</span>code))\n' );
document.write( '            <span style=\"color: #008000\">print</span>(<span style=\"color: #BA2121\">\"</span><span style=\"color: #AA5D1F; font-weight: bold\">t</span><span style=\"color: #BA2121\">Description: </span><span style=\"color: #A45A77; font-weight: bold\">{}</span><span style=\"color: #BA2121\">\"</span><span style=\"color: #666666\">.</span>format(response<span style=\"color: #666666\">.</span>outputs[<span style=\"color: #666666\">0</span>]<span style=\"color: #666666\">.</span>status<span style=\"color: #666666\">.</span>description))\n' );
document.write( '            <span style=\"color: #008000\">print</span>(<span style=\"color: #BA2121\">\"</span><span style=\"color: #AA5D1F; font-weight: bold\">t</span><span style=\"color: #BA2121\">Details: </span><span style=\"color: #A45A77; font-weight: bold\">{}</span><span style=\"color: #BA2121\">\"</span><span style=\"color: #666666\">.</span>format(response<span style=\"color: #666666\">.</span>outputs[<span style=\"color: #666666\">0</span>]<span style=\"color: #666666\">.</span>status<span style=\"color: #666666\">.</span>details))\n' );
document.write( '            <span style=\"color: #008000; font-weight: bold\">raise</span> <span style=\"color: #CB3F38; font-weight: bold\">Exception</span>(<span style=\"color: #BA2121\">\"Request failed, status code: \"</span> <span style=\"color: #666666\">+</span> <span style=\"color: #008000\">str</span>(response<span style=\"color: #666666\">.</span>status<span style=\"color: #666666\">.</span>code))\n' );
document.write( '\n' );
document.write( '        <span style=\"color: #3D7B7B; font-style: italic\"># get the response</span>\n' );
document.write( '        tag <span style=\"color: #666666\">=</span> response<span style=\"color: #666666\">.</span>outputs[<span style=\"color: #666666\">0</span>]<span style=\"color: #666666\">.</span>data<span style=\"color: #666666\">.</span>concepts[<span style=\"color: #666666\">0</span>]\n' );
document.write( '\n' );
document.write( '        <span style=\"color: #3D7B7B; font-style: italic\"># print them out</span>\n' );
document.write( '        <span style=\"color: #008000\">print</span>(<span style=\"color: #BA2121\">\'-----------------------------------------------\'</span>)\n' );
document.write( '        <span style=\"color: #008000\">print</span>(row[<span style=\"color: #666666\">0</span>])\n' );
document.write( '        <span style=\"color: #008000\">print</span>(<span style=\"color: #BA2121\">\'</span><span style=\"color: #A45A77; font-weight: bold\">%12s</span><span style=\"color: #BA2121\">: </span><span style=\"color: #A45A77; font-weight: bold\">%.2f</span><span style=\"color: #BA2121\">\'</span> <span style=\"color: #666666\">%</span> (tag<span style=\"color: #666666\">.</span>name, tag<span style=\"color: #666666\">.</span>value))\n' );
document.write( '\n' );
document.write( '        <span style=\"color: #3D7B7B; font-style: italic\"># store the row with the tag in the csv file</span>\n' );
document.write( '        csv_writer<span style=\"color: #666666\">.</span>writerow([row[<span style=\"color: #666666\">0</span>], row[<span style=\"color: #666666\">1</span>], tag<span style=\"color: #666666\">.</span>name, tag<span style=\"color: #666666\">.</span>value])\n' );
document.write( '</pre></div>\n' );
